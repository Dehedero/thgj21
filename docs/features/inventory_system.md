# 3.4. Система инвентаря

Система инвентаря в GOAT — это мощный инструмент для хранения, отображения и взаимодействия с предметами. Она состоит из глобального менеджера (`goat_inventory`), UI-сцен и поддержки 3D-моделей.

## Архитектура

- **Глобальный синглтон**: `goat_inventory` управляет всеми предметами, их добавлением, удалением, выбором и использованием. Все предметы идентифицируются по уникальному имени (строка).
- **UI-сцены**:
    - `Inventory.tscn` — основное окно инвентаря с 3D-просмотром предмета.
    - `InventoryBar.tscn` — панель быстрого доступа (отображается сбоку экрана).
    - `InventoryItems.tscn` — список предметов с кнопками для выбора, использования и комбинирования.

Подробнее о структуре и кастомизации UI-инвентаря см. [Вспомогательные UI-сцены](./helper_scenes.md#inventory).

## Как добавить новый предмет в инвентарь

Система инвентаря в GOAT спроектирована так, чтобы автоматически обнаруживать и регистрировать новые предметы, если они размещены в правильных директориях и названы в соответствии с соглашениями.

1.  **Создайте 3D-модель**:
    *   Создайте или импортируйте вашу 3D-модель. Важно, чтобы это была сохраненная сцена (`.tscn`), а не просто файл модели (`.obj`, `.glb`).
    *   Поместите сцену в папку: `res://game/inventory_items/models/`.
    *   Назовите файл сцены в **PascalCase** (например, `MyAwesomeKey.tscn`).

2.  **Создайте иконку**:
    *   Создайте иконку для вашего предмета в формате `.png`.
    *   Поместите иконку в папку: `res://game/inventory_items/icons/`.
    *   Назовите файл иконки в **snake_case**, и это имя должно соответствовать имени 3D-модели (например, `my_awesome_key.png`).

3.  **Готово!**
    *   При следующем запуске игры `goat_inventory` автоматически просканирует папку `models`, обнаружит `MyAwesomeKey.tscn`, зарегистрирует предмет с именем `my_awesome_key` и свяжет его с иконкой `my_awesome_key.png`.

**Если папок `inventory_items/models` или `inventory_items/icons` не существует в директории `res://game/`, просто создайте их.**

### Автоматическая генерация иконок

Если вы предоставите модель, но не предоставите иконку, система GOAT автоматически сгенерирует иконку для вас! Она использует сцену `IconMaker.tscn`, чтобы сделать "снимок" вашей 3D-модели на прозрачном фоне. Это очень удобно для быстрой разработки.

## Основные методы и сигналы `goat_inventory`

- **Методы**:
    - `add_item(item_name: String)` — добавить предмет.
    - `remove_item(item_name: String)` — удалить предмет.
    - `replace_item(replaced_item_name: String, replacing_item_name: String)` — заменить предмет.
    - `use_item(item_name: String, used_on_name = null)` — использовать предмет (или применить один предмет к другому).
    - `select_item(item_name: String)` — выбрать предмет.
    - `get_items() -> Array` — получить список всех предметов.
    - `get_selected_item()` — получить выбранный предмет.
    - `get_item_icon(item_name: String)` — получить иконку предмета.
    - `get_item_model(item_name: String)` — получить 3D-модель предмета.

- **Сигналы**:
    - `item_selected(item_name)` — выбран новый предмет.
    - `item_added(item_name)` — предмет добавлен.
    - `item_removed(item_name)` — предмет удалён.
    - `item_replaced(replaced_item_name, replacing_item_name)` — предмет заменён.
    - `item_used(item_name, used_on_name)` — предмет использован.
    - `items_changed(new_items)` — изменился список предметов.

## Работа с UI-инвентарём

- Открытие инвентаря: по умолчанию клавиша `Tab` (`goat_toggle_inventory`).
- В инвентаре можно:
    - Выбрать предмет (клик по иконке)
    - Использовать предмет (двойной клик или кнопка "Использовать")
    - Применить один предмет к другому (перетащить и отпустить на другой предмет)
    - Вращать 3D-модель предмета (зажать ПКМ и двигать мышью)
    - Сбросить вращение (кнопка "Сбросить вращение")
    - Выйти из инвентаря (клавиша `Tab` или `Esc`)

## Пример: добавить ключ в инвентарь через код

```gdscript
# Добавить предмет "key" в инвентарь
if not goat_inventory.get_items().has("key"):
    goat_inventory.add_item("key")
```

## Кастомизация и расширение

- Можно создавать свои UI-сцены, подписываясь на сигналы `goat_inventory`.
- Для сложных предметов реализуйте отдельные 3D-модели и логику использования через обработку сигнала `item_used`.
- Максимальная вместимость инвентаря задаётся константой `CAPACITY` (по умолчанию 8).

*   **Имя предмета**: Уникальный идентификатор предмета в игре.

## Как использовать предметы в игре

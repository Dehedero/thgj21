# 3.4. Система инвентаря

Система инвентаря в GOAT — это мощный инструмент для хранения, отображения и взаимодействия с предметами. Она состоит из глобального менеджера (`goat_inventory`), UI-сцен и поддержки 3D-моделей.

## Архитектура

- **Глобальный синглтон**: `goat_inventory` управляет всеми предметами, их добавлением, удалением, выбором и использованием. Все предметы идентифицируются по уникальному имени (строка).
- **UI-сцены**:
    - `Inventory.tscn` — основное окно инвентаря с 3D-просмотром предмета.
    - `InventoryBar.tscn` — панель быстрого доступа (отображается внизу экрана).
    - `InventoryItems.tscn` — список предметов с кнопками для выбора, использования и комбинирования.

Подробнее о структуре и кастомизации UI-инвентаря см. [Вспомогательные UI-сцены](./helper_scenes.md#inventory).

## Как добавить новый предмет в инвентарь

1. Поместите 3D-модель предмета в папку `game/goat/inventory_items/models/` (например, `Key.tscn`).
2. Поместите иконку предмета в папку `game/goat/inventory_items/icons/` (например, `key.png`).
3. Названия файлов должны совпадать (без расширения и регистра).
4. Предмет автоматически появится в конфиге инвентаря при запуске игры.

## Основные методы и сигналы `goat_inventory`

- **Методы**:
    - `add_item(item_name: String)` — добавить предмет.
    - `remove_item(item_name: String)` — удалить предмет.
    - `replace_item(replaced_item_name: String, replacing_item_name: String)` — заменить предмет.
    - `use_item(item_name: String, used_on_name = null)` — использовать предмет (или применить один предмет к другому).
    - `select_item(item_name: String)` — выбрать предмет.
    - `get_items() -> Array` — получить список всех предметов.
    - `get_selected_item()` — получить выбранный предмет.
    - `get_item_icon(item_name: String)` — получить иконку предмета.
    - `get_item_model(item_name: String)` — получить 3D-модель предмета.

- **Сигналы**:
    - `item_selected(item_name)` — выбран новый предмет.
    - `item_added(item_name)` — предмет добавлен.
    - `item_removed(item_name)` — предмет удалён.
    - `item_replaced(replaced_item_name, replacing_item_name)` — предмет заменён.
    - `item_used(item_name, used_on_name)` — предмет использован.
    - `items_changed(new_items)` — изменился список предметов.

## Работа с UI-инвентарём

- Открытие инвентаря: по умолчанию клавиша `Tab` (`goat_toggle_inventory`).
- В инвентаре можно:
    - Выбрать предмет (клик по иконке)
    - Использовать предмет (двойной клик или кнопка "Использовать")
    - Применить один предмет к другому (перетащить и отпустить на другой предмет)
    - Вращать 3D-модель предмета (зажать ПКМ и двигать мышью)
    - Сбросить вращение (кнопка "Сбросить вращение")
    - Выйти из инвентаря (клавиша `Tab` или `Esc`)

## Пример: добавить ключ в инвентарь через код

```gdscript
# Добавить предмет "key" в инвентарь
if not goat_inventory.get_items().has("key"):
    goat_inventory.add_item("key")
```

## Кастомизация и расширение

- Можно создавать свои UI-сцены, подписываясь на сигналы `goat_inventory`.
- Для сложных предметов реализуйте отдельные 3D-модели и логику использования через обработку сигнала `item_used`.
- Максимальная вместимость инвентаря задаётся константой `CAPACITY` (по умолчанию 8).

# 3.2. Контроллер игрока (`Player.tscn`)

`Player.tscn` — это готовая сцена для персонажа игрока, включающая в себя логику передвижения, управления камерой от первого лица и взаимодействия с другими системами.

## Структура сцены

Сцена `Player` состоит из нескольких ключевых узлов:

*   `CharacterBody3D`: Основной узел, отвечающий за физику и перемещение.
*   `Camera3D`: Камера от первого лица.
    *   `RayCast3D`: Используется для определения объекта, на который смотрит игрок, для взаимодействия.
    *   `Hand`: "Рука" игрока, в которой могут отображаться взятые предметы.
*   `CollisionShapeStanding` / `CollisionShapeCrouched`: Две формы коллапса для обычного состояния и состояния приседания.
*   `Inventory`: UI-сцена инвентаря.
*   `ContextInventory`: UI-сцена для контекстного взаимодействия предметов в инвентаре.
*   `Settings`: UI-сцена меню настроек.
*   `Scope`: UI-элемент, отображающий точку-прицел в центре экрана.

## Управление

Управление игроком осуществляется с помощью стандартных действий (actions), которые можно перенастроить в `Проект -> Настройки проекта -> Input Map`.

*   `goat_move_player_*` (forward, backward, left, right): Перемещение персонажа.
*   `Движение мыши`: Управление камерой.
*   `goat_toggle_inventory`: Открыть/закрыть инвентарь (по умолчанию `Tab`).
*   `goat_dismiss`: Открыть/закрыть меню настроек (по умолчанию `Escape`).
*   `goat_crouch`: Присесть (удерживать).
*   `goat_interact`: Взаимодействовать с объектом (по умолчанию `ЛКМ`).

## Режимы игры (`GameMode`)

Контроллер игрока тесно связан с глобальной системой `goat.game_mode`. В зависимости от текущего режима, поведение игрока меняется:

*   `EXPLORING`: Стандартный режим. Игрок может передвигаться, вращать камерой и взаимодействовать с миром. Курсор мыши захвачен.
*   `INVENTORY`: Режим инвентаря. Движение и взаимодействие отключены. Курсор мыши освобождается для управления инвентарем.
*   `SETTINGS`: Режим настроек. Аналогично режиму инвентаря.
*   `CUTSCENE`: Режим кат-сцены. Управление игроком полностью блокируется.

Переключение режимов происходит автоматически (например, при нажатии `Tab`) или программно через `goat.game_mode = goat.GameMode.CUTSCENE`.

## Настройка через `goat.gd`

Некоторые параметры поведения игрока можно настроить через глобальный скрипт `goat.gd`:

*   `PLAYER_SPEED`: Скорость передвижения игрока.
*   `BOTTOM_CAMERA_ANGLE` / `TOP_CAMERA_ANGLE`: Ограничение угла наклона камеры по вертикали.
*   `LEFT_CAMERA_ANGLE` / `RIGHT_CAMERA_ANGLE`: Ограничение угла поворота камеры по горизонтали (если не равны `null`).
*   `ALLOW_CAMERA_MOVEMENT_WHEN_VOICE_IS_PLAYING`: Разрешает ли вращение камеры во время проигрывания голосовых реплик.

## Кастомизация

Вы можете создать свою собственную сцену игрока, унаследовав ее от `addons/goat/main_scenes/Player.tscn` и изменив или расширив ее функциональность по своему усмотрению.
